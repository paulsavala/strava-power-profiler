<!DOCTYPE html>
<html>
  <head>
    <title>Strava Power Profiler</title>
    <link rel=stylesheet type=text/css href='{{ url_for('static',filename='style.css')}}'>
    <!-- jQuery stuff -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js">></script>
  	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
    <!-- Radar chart -->
    <script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/highcharts-more.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script>
	/* Radar chart */	
	function radar_chart(data_points) {

		var category_names = ['Climber', 'Roleur', 'Sprinter', 'Time Trialist'];
		
		$('#radar_chart').highcharts({

			chart: {
				polar: true,
				type: 'area'
			},

			title: {
				text: 'Segment Classifiction',
				x: 0
			},

			pane: {
				size: '80%'
			},

			xAxis: {
				categories: category_names,
				tickmarkPlacement: 'on',
				lineWidth: 0
			},

			yAxis: {
				gridLineInterpolation: 'polygon',
				lineWidth: 0,
				min: 0
			},

			series: [{
				name: '',
				data: data_points,
				pointPlacement: 'on'
			}]

		});
		
	};
	
	/* Call the radar chart at render time with 0 values */
	$( function () {
		radar_chart([0,0,0,0]);
	});
	
	/* Datepicker */
	$(function() {
    	$( "#datepicker1" ).datepicker();
    });
  	
  	$(function() {
    	$( "#datepicker2" ).datepicker();
  	});
  		
	/* Update the radar chart for the clicked segment */
	$(function() { 
    	{% for activity in recent_activities %}
			$('#activity_{{ activity.id }}')
			.mouseover(function() {
				$('#recent_segments').children().css('display', 'none');
				$('#segments_{{ activity.id }}').css('display', 'block'); 
			});
			{% for segment in activity_segments[activity.id] %}
				$('#segment_{{ segment.id }}')
				.click(function() {
					radar_chart([1,2,3,4]);
					$('#segment_stats_name').text('{{ segment.name }}');
					$('#segment_stats_distance').text('{{ segment.distance }}');
					$('#segment_stats_hill_score').text('{{ segment.hill_score }}');
					$('#segment_stats_var_score').text('{{ segment.var_score }}');
				});
			{% endfor %}
    	{% endfor %}

    });
	</script>
  </head>
  <body>
  	<div id="nav_bar">
  		<div id="user_pic"><img src="{{ url_for('static',filename='user_pic.jpg')}}" id="user_pic" alt="Pic"></img></div>
  		<div id="iowava">Power Profile</div>
  		<div id="username">{{ athlete.username }}</div>
  	</div>
  	<div id="graph">
  		<div id="segment_stats">
  			<div>Segment name: <span id="segment_stats_name"></span></div>
  			<div>Distance: <span id="segment_stats_distance"></span></div>
  			<div>Hill score: <span id="segment_stats_hill_score"></span></div>
  			<div>Var score: <span id="segment_stats_var_score"></span></div>
  		</div>
  		<div id="radar_chart"></div>
  	</div>
  	<div id="options">
  		<div id="recent_rides">
			<form id='recent_rides_options' method='POST' action={{ url_for('update_rides') }}>
				From: <input type="text" id="datepicker1" name="datepicker_after"> 
				Until: <input type="text" id="datepicker2" name="datepicker_before">
				<input type="submit" value="Update">
			</form>
  		</div>
  	</div>
  	<div id="recents">
  		<div id="recent_rides">
  			<table>
  				{% for activity in recent_activities %}
  				<tr id="activity_{{ activity.id }}">
  					<td class="table_label">{{ activity.start_date_local.strftime('%a, %b %d') }}</td>
  					<td class="table_data">{{ activity.name }}</td>
  					<td class="table_data">{{ activity.distance }} </td>
  				</tr>
  				{% endfor %}
  			</table>
  		</div>
  		<div id="recent_segments">
  			{% for activity in recent_activities %}
  			<table id="segments_{{ activity.id }}">
  				{% for segment in activity_segments[activity.id] %}
  				<tr id="segment_{{ segment.id }}">
  					<td class="table_label">{{ segment.name }}</td>
  				</tr>
  				{% endfor %}
  			</table>
			{% endfor %}
  		</div>
  	</div>
  	<div id="footer">
  		{{ debug }}<span id="testing"></span>
  	</div>
  </body>
</html>